# ç‰©ä¸šç®¡ç†ç³»ç»Ÿ API

åŸºäº Elysia + Drizzle + MySQL æ„å»ºçš„ç°ä»£åŒ–ç‰©ä¸šç®¡ç†ç³»ç»Ÿåç«¯APIã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ğŸ“ ä½å€ç®¡ç†
- æ”¯æŒå°åŒºã€æ ‹ã€æ¥¼å±‚ã€æˆ¿é—´çš„å››çº§æ ‘å½¢ç»“æ„
- ä½å€çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
- æ ‘å½¢ç»“æ„å±•ç¤ºå’Œå±‚çº§ç®¡ç†
- è½¯åˆ é™¤æœºåˆ¶ï¼Œä¿æŠ¤æ•°æ®å®Œæ•´æ€§

### ğŸ‘¥ ä½æˆ·ç®¡ç†
- ä¸šä¸»å’Œç§Ÿæˆ·ä¿¡æ¯ç®¡ç†
- ä½æˆ·ä¸ä½å€çš„å…³è”å…³ç³»
- ä½æˆ·è¿å…¥è¿å‡ºè®°å½•
- è”ç³»æ–¹å¼å’Œèº«ä»½ä¿¡æ¯ç®¡ç†

### ğŸ’° è´¹ç”¨ç®¡ç†
- å¤šç§è´¹ç”¨ç±»å‹æ”¯æŒï¼ˆæ°´è´¹ã€ç”µè´¹ã€ç‡ƒæ°”è´¹ã€ç‰©ä¸šè´¹ç­‰ï¼‰
- è´¹ç”¨çš„æ‰¹é‡åˆ›å»ºå’Œç®¡ç†
- ç¼´è´¹çŠ¶æ€è·Ÿè¸ª
- è´¹ç”¨ç»Ÿè®¡å’ŒæŠ¥è¡¨åŠŸèƒ½
- é€¾æœŸè´¹ç”¨æé†’

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: [Elysia](https://elysiajs.com/) - é«˜æ€§èƒ½ TypeScript Web æ¡†æ¶
- **ORM**: [Drizzle](https://orm.drizzle.team/) - ç±»å‹å®‰å…¨çš„ SQL ORM
- **æ•°æ®åº“**: MySQL 8.0+
- **ç±»å‹ç³»ç»Ÿ**: TypeScript 5.0+
- **APIæ–‡æ¡£**: Swagger/OpenAPI 3.0
- **å¼€å‘å·¥å…·**: Drizzle Kit, Bun

## ğŸ“¦ å®‰è£…å’Œé…ç½®

### 1. ç¯å¢ƒè¦æ±‚

- Node.js 18+ æˆ– Bun 1.0+
- MySQL 8.0+
- Git

### 2. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd wy2
```

### 3. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ npm
npm install

# æˆ–ä½¿ç”¨ bun (æ¨è)
bun install
```

### 4. ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶å¹¶é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=property_management

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development
```

### 5. æ•°æ®åº“åˆå§‹åŒ–

```bash
# ç”Ÿæˆæ•°æ®åº“è¿ç§»æ–‡ä»¶
npm run db:generate

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
npm run db:migrate

# (å¯é€‰) æŸ¥çœ‹æ•°æ®åº“ç»“æ„
npm run db:studio
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm run build
npm start
```

## ğŸ“š API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹APIæ–‡æ¡£ï¼š

- **Swagger UI**: http://localhost:3000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:3000/

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
wy2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routes/          # APIè·¯ç”±å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ addresses.ts # ä½å€ç®¡ç†è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ residents.ts # ä½æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚       â””â”€â”€ expenses.ts  # è´¹ç”¨ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schema.ts        # æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ dbTable.ts       # æ•°æ®åº“è¡¨ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts         # æ•°æ®åº“è¿æ¥é…ç½®
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ addressService.ts
â”‚   â”‚   â”œâ”€â”€ residentService.ts
â”‚   â”‚   â””â”€â”€ expenseService.ts
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ R.ts            # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â””â”€â”€ database.ts     # æ•°æ®åº“å·¥å…·
â”‚   â””â”€â”€ index.ts            # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ drizzle/                # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ drizzle.config.ts       # Drizzleé…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æ•°æ®åº“æ“ä½œ

```bash
# ç”Ÿæˆæ–°çš„è¿ç§»æ–‡ä»¶
npm run db:generate

# æ‰§è¡Œè¿ç§»
npm run db:migrate

# å¯åŠ¨ Drizzle Studio (æ•°æ®åº“å¯è§†åŒ–å·¥å…·)
npm run db:studio

# åˆ é™¤æ•°æ®åº“ (è°¨æ…ä½¿ç”¨)
npm run db:drop
```

### ä»£ç è§„èŒƒ

é¡¹ç›®éµå¾ªä»¥ä¸‹å¼€å‘è§„èŒƒï¼š

1. **è·¯ç”±æ³¨å†Œ**: æ‰€æœ‰è·¯ç”±å¿…é¡»åœ¨ `src/index.ts` ä¸­ä½¿ç”¨ `.use()` æ–¹æ³•æ³¨å†Œ
2. **ç±»å‹å®šä¹‰**: ä¼˜å…ˆä½¿ç”¨ Drizzle ç”Ÿæˆçš„ç±»å‹ï¼Œé€šè¿‡ `dbTable` è§£æ„è·å–
3. **å“åº”æ ¼å¼**: ç»Ÿä¸€ä½¿ç”¨ `utils/R.ts` ä¸­çš„ `ok()` å‡½æ•°è¿”å›å“åº”
4. **é”™è¯¯å¤„ç†**: åœ¨æœåŠ¡å±‚è¿›è¡Œé”™è¯¯æ•è·å’Œå¤„ç†
5. **ç±»å‹è½¬æ¢**: åœ¨æœåŠ¡å±‚è€Œéè·¯ç”±å±‚è¿›è¡Œç±»å‹è½¬æ¢

### API è®¾è®¡åŸåˆ™

- **RESTful**: éµå¾ª REST API è®¾è®¡è§„èŒƒ
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨ TypeScript å’Œ TypeBox ç¡®ä¿ç±»å‹å®‰å…¨
- **ç»Ÿä¸€å“åº”**: æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç 
- **æ–‡æ¡£å®Œæ•´**: æ¯ä¸ªæ¥å£éƒ½æœ‰å®Œæ•´çš„ OpenAPI æ–‡æ¡£

## ğŸ“‹ API æ¥å£æ¦‚è§ˆ

### ä½å€ç®¡ç† (`/api/addresses`)

- `GET /` - è·å–ä½å€åˆ—è¡¨ (æ”¯æŒåˆ†é¡µå’Œæœç´¢)
- `GET /tree` - è·å–ä½å€æ ‘å½¢ç»“æ„
- `GET /:id` - è·å–å•ä¸ªä½å€è¯¦æƒ…
- `POST /` - åˆ›å»ºæ–°ä½å€
- `PUT /:id` - æ›´æ–°ä½å€ä¿¡æ¯
- `DELETE /:id` - åˆ é™¤ä½å€ (è½¯åˆ é™¤)

### ä½æˆ·ç®¡ç† (`/api/residents`)

- `GET /` - è·å–ä½æˆ·åˆ—è¡¨ (æ”¯æŒåˆ†é¡µå’Œæœç´¢)
- `GET /:id` - è·å–å•ä¸ªä½æˆ·è¯¦æƒ…
- `GET /address/:addressId` - è·å–æŒ‡å®šä½å€çš„ä½æˆ·
- `POST /` - åˆ›å»ºæ–°ä½æˆ·
- `PUT /:id` - æ›´æ–°ä½æˆ·ä¿¡æ¯
- `PUT /:id/move-out` - ä½æˆ·è¿å‡º
- `DELETE /:id` - åˆ é™¤ä½æˆ· (è½¯åˆ é™¤)

### è´¹ç”¨ç®¡ç† (`/api/expenses`)

- `GET /` - è·å–è´¹ç”¨åˆ—è¡¨ (æ”¯æŒåˆ†é¡µå’Œæœç´¢)
- `GET /statistics` - è·å–è´¹ç”¨ç»Ÿè®¡ä¿¡æ¯
- `GET /:id` - è·å–å•ä¸ªè´¹ç”¨è¯¦æƒ…
- `GET /address/:addressId` - è·å–æŒ‡å®šä½å€çš„è´¹ç”¨
- `POST /` - åˆ›å»ºæ–°è´¹ç”¨
- `POST /batch` - æ‰¹é‡åˆ›å»ºè´¹ç”¨
- `PUT /:id` - æ›´æ–°è´¹ç”¨ä¿¡æ¯
- `PUT /:id/pay` - è´¹ç”¨ç¼´è´¹
- `DELETE /:id` - åˆ é™¤è´¹ç”¨

## ğŸš€ éƒ¨ç½²

### Docker éƒ¨ç½² (æ¨è)

```bash
# æ„å»ºé•œåƒ
docker build -t property-management-api .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name property-api \
  -p 3000:3000 \
  -e DB_HOST=your_db_host \
  -e DB_PASSWORD=your_db_password \
  property-management-api
```

### ä¼ ç»Ÿéƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æœåŠ¡
npm start
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [Issue](../../issues)
- å‘é€é‚®ä»¶è‡³: support@property-management.com

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œè¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®å’Œå®‰å…¨è®¾ç½®ã€‚